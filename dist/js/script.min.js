"use strict";function initScreen(){screenHeight=$(".c-slide--active").height(),$(".s-site").height(screenHeight),slideButtons(),updateStats(),buildTable(),initGame()}function restartButtons(){$("[js-game-restart]").on("tap",function(){window.location.reload(!0)})}function modalButtons(){$("[js-modal-close]").on("tap",function(){$(this).closest(".c-modal").fadeOut(200,function(){$(this).remove()})})}function initGame(){$("[js-button-jet]").on("tap",function(){$(this).hasClass("button--disabled")||updateDay()}),$("[js-length]").on("tap",function(){$(this).removeClass("button--deselect"),$("[js-length]").not($(this)).addClass("button--deselect");var e=$(this).attr("data-game-length");player.invMax=e>7?100:50,player.dayMax=e,updateStats(),$("[js-slide-button]").removeClass("button--disabled")})}function buttonTradeInit(){$.event.special.tap.tapholdThreshold=400,$(".button--trade").on("tap",function(){buttonTrade($(this),"tap")}).on("taphold",function(){buttonTrade($(this),"taphold")}),setRandomPrices()}function buttonTrade(e,a){if(!e.hasClass("button--disabled")){var t,o=e.closest("tr"),n=o.attr("data-js-dope"),s=parseInt(o.find("[js-dope-price]").html());t="tap"===a?e.hasClass("button--buy")?1:-1:e.hasClass("button--buy")?Math.floor(player.cash/s):-1*o.find("[js-dope-amount]").html();var r=player.invCurr,i=player.invMax-r;t>i&&(t=i),player.cash-=s*t,updateStats(),updateDopeAmount(n,t)}}function disableButtons(){dopelist.forEach(function(e){var a=$('[data-js-dope="'+e.name+'"]'),t=parseInt(a.find("[js-dope-amount]").html()),o=a.find("[js-dope-sell]").find(".button--trade");t<=0?o.addClass("button--disabled"):o.removeClass("button--disabled");var n=parseInt(a.find("[js-dope-price]").html()),s=a.find("[js-dope-buy]").find(".button--trade");n>player.cash?s.addClass("button--disabled"):s.removeClass("button--disabled");var r=$("[js-inv-curr]").html();$("[js-inv-max]").html()-r<=0&&s.addClass("button--disabled")})}function updateDopeAmount(e,a){for(var t in dopelist)dopelist[t].name==e&&(dopelist[t].amount+=a,$('[data-js-dope="'+e+'"]').find("[js-dope-amount]").html(dopelist[t].amount));player.invCurr+=a,updateStats(),disableButtons()}function setRandomPrices(){dopelist.forEach(function(e){updateDopePrice(e,1)})}function updateDopePrice(e,a){var t=e.priceCurr(a),o=$('[data-js-dope="'+e.name+'"]').find("[js-dope-price]");o.html(t),t<e.priceMin?t=e.priceMin:t>e.priceMax&&(t=e.priceMax);var n=(t-e.priceMin)/(e.priceMax-e.priceMin),s="rgb(255,255,255)";if(n>.5){var r=Math.floor(255-510*(n-.5));s="rgb(255,"+r+","+r+")"}else{var i=Math.floor(255-510*(.5-n));s="rgb("+i+",255,"+i+")"}o.css("color",s),disableButtons()}function updateDay(){setRandomPrices(),player.dayCurr>=player.dayMax?(dopelist.forEach(function(e){var a=$('[data-js-dope="'+e.name+'"]'),t=parseInt(a.find("[js-dope-amount]").html());if(t>0){var o=parseInt(a.find("[js-dope-price]").html());player.cash+=o*t}}),updateStats(),removeSlide($(this).closest(".c-slide")),createModal("            <h2>Doperun over!</h2>            <p>What a run! Your final score is "+digits(player.cash)+'</p>            <div class="c-button-group">                <div class="button" js-game-restart>Again!</div>            </div>        '),restartButtons()):(player.dayCurr+=1,updateStats(),randomEvents())}function dopeFound(){var e,a=randomDope(dopelist).name,t=Math.floor(5*Math.random())+1,o=Math.random();e=o>.33?"You find "+t+" "+a+" on the subway.":o>.66?"An old friend drops by and he gives you "+t+" "+a+".":"In the back of your pocket you find "+t+" "+a+"!","Cocaine"!=a&&"Heroin"!=a&&(createModal("            <h2>Free Dope!</h2>            <p>"+e+'</p>            <div class="button" js-modal-close>Score!</div>        '),updateDopeAmount(a,t))}function dopeHigh(){var e=randomDope(dopelist);createModal("        <h2>Drug Bust!</h2>        <p>"+randomFrom(["Addicts are buying "+e.name+" for ridiculous prices!","Cops made a big "+e.name+" bust! Prices are outrageous!","The police raided a big "+e.name+" warehouse. Prices have skyrocketed!"])+'</p>        <div class="button" js-modal-close>Alright</div>    '),updateDopePrice(e,2)}function dopeLow(){var e,a=randomDope(dopelist),t="        <h2>Market flooded!</h2>        <p>"+(e="Hashish"===a?"The Marrakesh Express has arrived!":"Rival gangs raided some pharmacies and cheap "+a.name+" has flooded the market")+'</p>        <div class="button" js-modal-close>Cool</div>    ';dopelist.filter(function(e){return dopelist.name===e});createModal(t),updateDopePrice(a,.1)}function findCoat(){player.invMax+=10,updateStats(),createModal('        <h2>Trench coat</h2>        <p>You find an awesome trenchcoat with extra pockets!</p>        <div class="c-button-group">            <div class="button" js-modal-close>Stylish!</div>        </div>    ')}function findGun(){if(player.cash>=100)e='            <h2>Carrying</h2>            <p>Do you want to buy a gun for $100?</p>            <div class="c-button-group c-gun__controls">                <div class="button button--inline" js-gun-buy>Yeah!</div>                <div class="button button--inline" js-modal-close>Nah</div>            </div>        ';else var e='            <h2>Low on cash</h2>            <p>Someone offers to sell you a bigger gun for $100 but you are broke!</p>            <div class="c-gun__controls">                <div class="button" js-modal-close>Bummer!</div>            </div>        ';createModal(e),$("[js-gun-buy]").on("tap",function(){player.cash-=100,player.invCurr+=5,player.gun+=1,updateStats(),$(this).closest(".c-modal").fadeOut(200,function(){$(this).remove()})})}function officerHardass(){var e=Object.create({health:100,loot:50,damage:10,winChance:50,escapeChance:30,biteChance:70,dropChance:50,bribeCost:500});createModal('        <h2>The pigs!</h2>        <p class="c-combat__result">Officer Hardass and his deputies are chasing you! What do you do?</p>        <div class="s-row c-combat">            <div class="s-row__column s-row__column--half">                Hardass: <div class="c-health c-health--enemy"><span>'+e.health+'</span></div>            </div>            <div class="s-row__column s-row__column--half">                You: <div class="c-health c-health--player"><span>'+player.health+'</span></div>            </div>        </div>        <div class="c-button-group c-combat__controls">            <div class="button button--inline" js-combat-run>Run</div>            <div class="button button--inline" js-combat-fight>Fight</div>            <div class="button button--inline" js-combat-bribe>Bribe</div>        </div>    '),$(".c-health--player span").html(player.health).css("width",player.health+"%"),$("[js-combat-bribe]").on("tap",function(){var a,t=Math.ceil(e.bribeCost*Math.random())+e.bribeCost;player.cash<t?(a="Maybe you should save some cash first, dipshit...",$("[js-combat-bribe]").hide()):a="Ill see it through the fingers this time.<br />But its gonna cost ya $"+t+".",$(".c-combat__result").html(a),$("[js-combat-bribe]").html("pay").on("tap",function(){player.cash-=t,updateStats(),$(this).closest(".c-modal").fadeOut(200,function(){$(this).remove()})})}),$("[js-combat-run]").on("tap",function(){var a;if(e.escapeChance>=100*Math.random())$(".c-combat__controls").hide(),a="You got away!",$(".c-combat").after('<div class="button" js-modal-close>Too close</div>'),modalButtons();else{var t=Math.ceil(4*Math.random());if(e.biteChance>=100*Math.random()){var o=Math.ceil(e.damage*Math.random())+2;a="Police dogs chase your for "+t+" blocks<br />You were bit for "+o+" damage!",player.health-=o,player.health<=0&&(player.health=0,$(".c-combat__controls").hide(),a="Police dogs grab you and you bleed out on the streets. Your final score is: "+digits(player.cash),$(".c-combat").after('<div class="button" js-game-restart>Nasty</div>'),restartButtons()),$(".c-health--player span").html(player.health).css("width",player.health+"%")}else a="Police dogs chase your for "+t+" blocks"}$(".c-combat__result").html(a)}),$("[js-combat-fight]").on("tap",function(){var a;if(e.winChance>=100*Math.random()){a="You shot officer Hardass!";var t=Math.ceil(player.damage*Math.random())*(player.gun+1)+player.damage;if(e.health-=t,e.health<=0){e.health=0,$(".c-combat__controls").hide();var o=Math.ceil(e.loot*Math.random())+e.loot;a="Officer Hardass drops dead!<br />On his body you find $"+o+".",player.cash+=o,updateStats(),$(".c-combat").after('<div class="button" js-modal-close>Later Hardass</div>'),modalButtons()}$(".c-health--enemy span").html(e.health).css("width",e.health+"%")}else{a="Officer Hardass takes a shot at you.";var n=Math.ceil(e.damage*Math.random())+e.damage;player.health-=n,player.health<=0&&(player.health=0,$(".c-combat__controls").hide(),a="Officer Hardass shot you dead sucker!<br />Your final score is: "+digits(player.cash),$(".c-combat").after('<div class="button" js-game-restart>Ah man!</div>'),restartButtons()),$(".c-health--player span").html(player.health).css("width",player.health+"%")}$(".c-combat__result").html(a)})}function oldLady(){alert("oldLady")}function pennyFound(){var e=Math.floor(100*Math.random())+1,a=Math.random();createModal("        <h2>Free monies!</h2>        <p>"+(a>.33?"Someone left some cash in an alley, you find $"+e+".":a>.66?"Your auntie May died and she left you $"+e+" inheritance.":"The cashier made a mistake on your change, you keep $"+e+" extra.")+'</p>        <div class="button" js-modal-close>Rad!</div>    '),player.cash+=e,updateStats()}function randomQuote(){var e=randomFrom(["I was raised a Christian and turned into a stone-faced acid head","I am more dope than heroin, sharper than a needle","I tried marijuana once. I did not inhale","Who are the Warriors?","I am not a demon. I am a lizard, a shark, a heat-seeking panther","Avoid all needle drugs, the only dope worth shooting is Richard Nixon","I have never been to New Zealand before. But one of my role models, Xena, the warrior princess, comes from there"]);createModal("        <h2>A new day</h2>        <p>"+randomFrom(['A homeless bum rubs against you and slurrs: "'+e+'".','An old lady on the subway sings softly: "'+e+'".','"'+e+'" you hear someone shout on the streets.','This hipcat swings by and says "'+e+'".','"'+e+'" a local newspaper reads.',"All is quiet on the streets.","You hear a song from Bob Dylan drifting from an open second floor window.","Nothing much happens."])+'</p>        <div class="button" js-modal-close>Lets deal</div>    ')}function buildTable(){dopelist.forEach(function(e){$("[js-dope-table-content]").append('            <tr js-dope data-js-dope="'+e.name+'">                <td>'+e.name+"</td>                <td js-dope-amount>"+e.amount+'</td>                <td js-dope-sell><button class="button button--trade button--sell"></button></td>                <td js-dope-price></td>                <td js-dope-buy><button class="button button--trade button--buy"></button></td>            </tr>        ')}),buttonTradeInit()}function slideButtons(){$("[js-slide-button]").each(function(){$(this).on("tap",function(){$(".c-slide").removeClass("c-slide--remove");var e=$(this).attr("js-slide-target");$("[js-slide__"+e+"]").addClass("c-slide--active"),$(this).closest(".c-slide").removeClass("c-slide--active").addClass("c-slide--remove"),$(".s-site__masthead").addClass("lowered")})})}function removeSlide(e){e.removeClass("c-slide--active").addClass("c-slide--remove")}function digits(e,a,t,o){if(null==e||!isFinite(e))throw new TypeError("number is not valid");if(!a){var n=e.toString().split(".").length;a=n>1?n:0}t||(t=","),o||(o=".");var s=(e=(e=parseFloat(e).toFixed(a)).replace(".",t)).split(t);return s[0]=s[0].replace(/\B(?=(\d{3})+(?!\d))/g,o),e="$"+s.join(t)}function updateStats(){$("[js-day-curr]").html(player.dayCurr),$("[js-day-max]").html(player.dayMax),$("[js-cash]").find("span").html(digits(player.cash)),$("[js-inv-curr]").html(player.invCurr),$("[js-inv-max]").html(player.invMax)}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,showError):x.innerHTML="Geolocation is not supported by this browser."}function showPosition(e){x.innerHTML="Latitude: "+e.coords.latitude+"<br />Longitude: "+e.coords.longitude}function showError(e){switch(e.code){case e.PERMISSION_DENIED:x.innerHTML="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:x.innerHTML="Location information is unavailable.";break;case e.TIMEOUT:x.innerHTML="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:x.innerHTML="An unknown error occurred."}}function createModal(e){$("body").append('        <div class="c-modal">            <div class="c-modal__content">                '+e+"            </div>        </div>    ").fadeIn(200),modalButtons()}function Dope(e,a,t,o){this.name=e,this.priceMin=a,this.priceMax=t,this.amount=o,this.priceCurr=function(e){var o,n;e<1?(o=a/2,n=1.5*a):1===e?(o=a,n=t):e>1&&(o=t-a,n=t+a);var s=Math.random();return this.random=s,Math.floor((n-o+1)*s+o)},dopelist.push(this)}function Event(e,a){this.name=e,this.chance=a,eventList.push(this)}function getEventChange(e,a){return e.chance*(100/a)}function getRandomEvent(e){for(var a=0;a<e.length;a++)if(e[a].chance>=100*eventRNG)return eventRNG=Math.random(),e[a]}function randomEvents(){if(Math.random()>=1-randomChanceTrigger){var e=getRandomEvent(eventMap);window[e.name]()}}function randomFrom(e){return e[Math.floor(Math.random()*e.length)]}function dopeArray(e){this.name=e}var screenHeight;$(window).load(function(){initScreen()});var x=$(".geolocation");$("[js-toggle]").on("click",function(){var e=$(this).attr("data-target");$("."+e).toggleClass("active").slideToggle()});var dopelist=[],dope1=new Dope("Acid",1e3,4400,0),dope2=new Dope("Cocaine",15e3,29e3,0),dope3=new Dope("Hashish",480,1280,0),dope4=new Dope("Heroin",5500,13e3,0),dope5=new Dope("Ludes",11,60,0),dope6=new Dope("MDA",1500,4400,0),dope7=new Dope("Opium",540,1250,0),dope8=new Dope("PCP",1e3,2500,0),dope9=new Dope("Peyote",220,700,0),dope10=new Dope("Shrooms",630,1300,0),dope11=new Dope("Speed",90,250,0),dope12=new Dope("Weed",315,890,0),PlayerConstruct={health:100,cash:2e3,invCurr:0,invMax:50,damage:20,gun:0,dayCurr:1,dayMax:7},player=Object.create(PlayerConstruct),eventList=[],eventRNG=Math.random(),randomChanceTrigger=1,event1=new Event("oldLady",0),event2=new Event("officerHardass",10),event3=new Event("dopeLow",5),event4=new Event("dopeHigh",20),event5=new Event("dopeFound",5),event6=new Event("pennyFound",20),event7=new Event("findCoat",5),event8=new Event("findGun",5),event9=new Event("randomQuote",40),eventTotal=0;eventList.forEach(function(e){eventTotal+=e.chance});var eventMap=[],range=0;eventList.forEach(function(e){range+=getEventChange(e,eventTotal),eventMap.push(new Event(e.name,range))});var dopeMap=[];dopelist.forEach(function(e){dopeMap.push(new dopeArray(e.name))});var randomDope=function(e){var a=Object.keys(e);return e[a[a.length*Math.random()<<0]]};